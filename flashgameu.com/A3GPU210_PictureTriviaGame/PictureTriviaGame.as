package {	import flash.display.*;	import flash.text.*;	import flash.events.*;	import flash.net.URLLoader;	import flash.net.URLRequest;		public class PictureTriviaGame extends MovieClip {				// question data		private var dataXML:XML;				// text formats		private var questionFormat:TextFormat;		private var answerFormat:TextFormat;		private var scoreFormat:TextFormat;				// text fields		private var messageField:TextField;		private var questionField:TextField;		private var scoreField:TextField;				// sprites and objects		private var gameSprite:Sprite;		private var questionSprite:Sprite;		private var answerSprites:Sprite;		private var gameButton:GameButton;				// game state variables		private var questionNum:int;		private var correctAnswer:String;		private var numQuestionsAsked:int;		private var numCorrect:int;		private var answers:Array;				public function startTriviaGame() {						// create game sprite			gameSprite = new Sprite();			addChild(gameSprite);						// set text formats			questionFormat = new TextFormat("Arial",24,0x330000,true,false,false,null,null,"center");			answerFormat = new TextFormat("Arial",18,0x330000,true,false,false,null,null,"left");			scoreFormat = new TextFormat("Arial",18,0x330000,true,false,false,null,null,"center");						// create score field and starting message text			scoreField = createText("",questionFormat,gameSprite,0,360,550);			messageField = createText("Loading Questions...",questionFormat,gameSprite,0,50,550);						// set up game state and load questions			questionNum = 0;			numQuestionsAsked = 0;			numCorrect = 0;			showGameScore();			xmlImport();		}				// start loading of questions		public function xmlImport() {			var xmlURL:URLRequest = new URLRequest("trivia3.xml");			var xmlLoader:URLLoader = new URLLoader(xmlURL);			xmlLoader.addEventListener(Event.COMPLETE, xmlLoaded);		}				// questions loaded		public function xmlLoaded(event:Event) {			dataXML  = XML(event.target.data);			gameSprite.removeChild(messageField);			messageField = createText("Get ready for the first question!",questionFormat,gameSprite,0,60,550);			showGameButton("GO!");		}				// creates a text field		public function createText(text:String, tf:TextFormat, s:Sprite, x,y: Number, width:Number): TextField {			var tField:TextField = new TextField();			tField.x = x;			tField.y = y;			tField.width = width;			tField.defaultTextFormat = tf;			tField.selectable = false;			tField.multiline = true;			tField.wordWrap = true;			if (tf.align == "left") {				tField.autoSize = TextFieldAutoSize.LEFT;			} else {				tField.autoSize = TextFieldAutoSize.CENTER;			}			tField.text = text;			s.addChild(tField);			return tField;		}				// updates the score		public function showGameScore() {			scoreField.text = "Number of Questions: "+numQuestionsAsked+"   Number Correct: "+numCorrect;		}				// ask player if they are ready for next question		public function showGameButton(buttonLabel:String) {			gameButton = new GameButton();			gameButton.label.text = buttonLabel;			gameButton.x = 220;			gameButton.y = 300;			gameSprite.addChild(gameButton);			gameButton.addEventListener(MouseEvent.CLICK,pressedGameButton);		}				// player is ready		public function pressedGameButton(event:MouseEvent) {			// clean up question			if (questionSprite != null) {				gameSprite.removeChild(questionSprite);			}						// remove button and message			gameSprite.removeChild(gameButton);			gameSprite.removeChild(messageField);						// ask the next question			if (questionNum >= dataXML.child("*").length()) {				gotoAndStop("gameover");			} else {				askQuestion();			}		}				// set up the question		public function askQuestion() {			// prepare new question sprite			questionSprite = new Sprite();			gameSprite.addChild(questionSprite);						// create text field for question			var question:String = dataXML.item[questionNum].question;			if (dataXML.item[questionNum].question.@type == "text") {				questionField = createText(question,questionFormat,questionSprite,0,60,550);			} else {				var questionLoader:Loader = new Loader();				var questionRequest:URLRequest = new URLRequest("triviaimages/"+question);				questionLoader.load(questionRequest);				questionLoader.y = 50;				questionSprite.addChild(questionLoader);			}						// create sprite for answers, get correct answer and shuffle all			correctAnswer = dataXML.item[questionNum].answers.answer[0];			answers = shuffleAnswers(dataXML.item[questionNum].answers);						// put each answer into a new sprite with a circle icon			answerSprites = new Sprite();			var xpos:int = 0;			var ypos:int = 0;			for(var i:int=0;i<answers.length;i++) {				var answerSprite:Sprite = new Sprite();				if (answers[i].type == "text") {					var answerField:TextField = createText(answers[i].value,answerFormat,answerSprite,0,0,200);				} else {					var answerLoader:Loader = new Loader();					var answerRequest:URLRequest = new URLRequest("triviaimages/"+answers[i].value);					answerLoader.load(answerRequest);					answerSprite.addChild(answerLoader);				}				var letter:String = String.fromCharCode(65+i); // A-D				var circle:Circle = new Circle(); // from Library				circle.letter.text = letter;				circle.answer = answers[i].value;				answerSprite.x = 100+xpos*250;				answerSprite.y = 150+ypos*100;				xpos++				if (xpos > 1) {					xpos = 0;					ypos += 1;				}				answerSprite.addChild(circle);				answerSprite.addEventListener(MouseEvent.CLICK,clickAnswer); // make it a button								// set a larger click area				answerSprite.graphics.beginFill(0x000000,0);				answerSprite.graphics.drawRect(-50, 0, 200, 80);				answerSprites.addChild(answerSprite);			}			questionSprite.addChild(answerSprites);		}		// take all the answers and shuffle them into an array		public function shuffleAnswers(answers:XMLList) {			var shuffledAnswers:Array = new Array();			while (answers.child("*").length() > 0) {				var r:int = Math.floor(Math.random()*answers.child("*").length());				shuffledAnswers.push({type: answers.answer[r].@type, value: answers.answer[r]});				delete answers.answer[r];			}			return shuffledAnswers;		}				// player selects an answer		public function clickAnswer(event:MouseEvent) {						// get selected answer text, and compare			var selectedAnswer = event.currentTarget.getChildAt(1).answer;			if (selectedAnswer == correctAnswer) {				numCorrect++;				messageField = createText("You got it!",questionFormat,gameSprite,0,140,550);			} else {				messageField = createText("Incorrect! The correct answer was:",questionFormat,gameSprite,0,140,550);			}						finishQuestion();		}				public function finishQuestion() {			// remove all but the correct answer			for(var i:int=0;i<4;i++) {				answerSprites.getChildAt(i).removeEventListener(MouseEvent.CLICK,clickAnswer);				if (answers[i].value != correctAnswer) {					answerSprites.getChildAt(i).visible = false;				} else {					answerSprites.getChildAt(i).x = 100;					answerSprites.getChildAt(i).y = 200;				}			}			// next question			questionNum++;			numQuestionsAsked++;			showGameScore();			showGameButton("Continue");		}				// clean up sprites		public function cleanUp() {			removeChild(gameSprite);			gameSprite = null;			questionSprite = null;			answerSprites = null;			dataXML = null;		}	}}